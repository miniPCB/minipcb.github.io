<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Component Part Number Generator</title>
  <style>
    :root {
      --bg: #0e1118;
      --panel: #151b25;
      --text: #e8edf5;
      --muted: #98a7bb;
      --border: #2d3a4d;
      --shadow: 0 8px 28px rgba(0, 0, 0, 0.35);
      --mono: "Consolas", "Courier New", monospace;
      --sans: "Segoe UI", "Trebuchet MS", sans-serif;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(circle at 20% 0%, #1b2434 0%, transparent 50%),
        radial-gradient(circle at 90% 100%, #132036 0%, transparent 45%),
        var(--bg);
      min-height: 100vh;
    }

    .page {
      width: min(1920px, calc(100vw - 24px));
      margin: 0 auto;
      padding: 16px;
      display: grid;
      grid-template-rows: auto auto 1fr;
      gap: 12px;
      min-height: 100vh;
    }

    .header, .pn-bar, .panel, .component-bar {
      border: 1px solid var(--border);
      background: var(--panel);
      border-radius: 12px;
      box-shadow: var(--shadow);
    }

    .header { padding: 14px; }
    .title { margin: 0; font-size: 1.2rem; letter-spacing: 0.02em; }
    .subtitle { margin: 6px 0 0; color: var(--muted); font-size: 0.9rem; }

    .component-bar {
      padding: 10px 12px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .component-label {
      font-size: 0.78rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.04em;
      margin-right: 4px;
    }

    .component-btn {
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 6px 11px;
      font-size: 0.8rem;
      color: var(--text);
      background: #1a2638;
      cursor: pointer;
    }

    .component-btn.active {
      border-color: rgba(102, 163, 255, 0.7);
      background: rgba(102, 163, 255, 0.2);
      color: #d9ebff;
      box-shadow: inset 0 0 0 1px rgba(102, 163, 255, 0.28);
      font-weight: 700;
    }

    .component-view.hidden { display: none; }

    .pn-bar {
      padding: 10px 12px;
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 10px;
      align-items: center;
      background: #101823;
      position: sticky;
      top: 8px;
      z-index: 50;
    }

    .pn-label {
      font-size: 0.78rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .pn-text {
      font-family: var(--mono);
      font-size: 0.98rem;
      color: #c6e3ff;
      overflow-x: auto;
      white-space: nowrap;
    }

    .pn-help {
      font-size: 0.78rem;
      color: var(--muted);
      text-align: right;
      white-space: nowrap;
    }

    .main {
      display: grid;
      grid-template-columns: minmax(360px, 36%) minmax(420px, 64%);
      gap: 12px;
      min-height: 0;
    }

    .panel {
      overflow: hidden;
      min-height: 0;
      display: flex;
      flex-direction: column;
    }

    .panel h2 {
      margin: 0;
      padding: 10px 12px;
      font-size: 1rem;
      border-bottom: 1px solid var(--border);
      background: #1a2230;
    }

    .panel-body { padding: 10px; overflow: auto; }

    .group {
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #101823;
      padding: 10px;
      margin-bottom: 10px;
    }

    .group-title {
      margin: 0 0 8px;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--muted);
    }

    .pill-cloud {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .filter-pill {
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 6px 11px;
      font-size: 0.8rem;
      color: var(--text);
      background: #1a2638;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      line-height: 1.2;
    }

    .filter-pill .count {
      color: var(--muted);
      font-size: 0.74rem;
      font-family: var(--mono);
    }

    .filter-pill.active {
      border-color: rgba(102, 163, 255, 0.7);
      background: rgba(102, 163, 255, 0.2);
      color: #d9ebff;
      box-shadow: inset 0 0 0 1px rgba(102, 163, 255, 0.28);
      font-weight: 700;
    }

    .filter-pill.disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    .text-input {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 8px;
      min-height: 36px;
      background: #1e2837;
      color: var(--text);
      padding: 0 10px;
      font-family: var(--mono);
      font-size: 0.88rem;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    .text-input.valid {
      border-color: rgba(46, 204, 113, 0.75);
      background: rgba(46, 204, 113, 0.12);
      box-shadow: inset 0 0 0 1px rgba(46, 204, 113, 0.25);
    }

    .text-input.invalid {
      border-color: rgba(255, 87, 87, 0.8);
      background: rgba(255, 87, 87, 0.1);
      box-shadow: inset 0 0 0 1px rgba(255, 87, 87, 0.28);
    }

    .hint { margin-top: 6px; color: var(--muted); font-size: 0.78rem; }
    .hint.ok { color: #7be6a8; }
    .hint.bad { color: #ff9a9a; }
    .mini-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.76rem;
      color: var(--muted);
    }
    .mini-table th, .mini-table td {
      border: 1px solid var(--border);
      padding: 5px 6px;
      text-align: left;
      vertical-align: top;
    }
    .mini-table th {
      background: #1a2230;
      color: var(--text);
      font-weight: 600;
    }

    .btn {
      border: 1px solid var(--border);
      background: #1e2837;
      color: var(--text);
      border-radius: 8px;
      min-height: 34px;
      padding: 0 10px;
      cursor: pointer;
      font-size: 0.82rem;
    }

    .summary-line {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
      border-bottom: 1px solid var(--border);
      padding: 10px 12px;
      color: var(--muted);
      font-size: 0.88rem;
      background: #1a2230;
    }

    .summary-line strong {
      color: var(--text);
      font-family: var(--mono);
      font-size: 0.95rem;
    }

    .results {
      overflow: auto;
      padding: 10px;
      display: grid;
      gap: 8px;
      align-content: start;
    }

    .result-card {
      border: 1px solid var(--border);
      background: #101823;
      border-radius: 10px;
      padding: 9px 11px;
    }

    .pn {
      font-family: var(--mono);
      font-weight: 700;
      color: #c6e3ff;
      word-break: break-all;
      font-size: 0.94rem;
    }

    .meta {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 7px;
      color: var(--muted);
      font-size: 0.78rem;
    }

    .meta span {
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 3px 8px;
      background: #142033;
    }

    @media (max-width: 980px) {
      .pn-bar { grid-template-columns: 1fr; }
      .pn-help { text-align: left; white-space: normal; }
      .main { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="page">
    <section class="header">
      <h1 class="title">Component Part Number Generator</h1>
      <p class="subtitle">Select a component family, then configure part-number code fields.</p>
    </section>

    <section class="component-bar">
      <span class="component-label">Component Type</span>
      <button type="button" class="component-btn active" data-component="m55342">M55342 / D55342 Resistor</button>
      <button type="button" class="component-btn" data-component="t502">T502 Capacitor</button>
    </section>

    <section id="m55342View" class="component-view">
    <section class="pn-bar">
      <div class="pn-label">Selected PN</div>
      <div id="pnBarText" class="pn-text">M55342_ _ _ _ _ _ _</div>
      <div class="pn-help">Format: Model + TCR + Case + Term + ValueCode + FR + Pack + ThinFilm</div>
    </section>

    <section class="main">
      <aside class="panel">
        <h2>Filters</h2>
        <div class="panel-body">
          <div class="group"><p class="group-title">Model</p><div id="modelFilter" class="pill-cloud"></div></div>
          <div class="group"><p class="group-title">TCR Code</p><div id="tcrFilter" class="pill-cloud"></div></div>
          <div class="group"><p class="group-title">Case Size / Slash</p><div id="sizeFilter" class="pill-cloud"></div></div>
          <div class="group"><p class="group-title">Termination</p><div id="termFilter" class="pill-cloud"></div></div>
          <div class="group">
            <p class="group-title">Resistance Input (Ohms)</p>
            <input id="resInput" class="text-input" type="text" value="5.60" />
            <div id="resHint" class="hint">Required format: three digits + decimal point. Allowed: <span style="font-family:var(--mono)">.560</span>, <span style="font-family:var(--mono)">5.60</span>, <span style="font-family:var(--mono)">56.0</span>, <span style="font-family:var(--mono)">560.</span></div>
            <div id="milHint" class="hint">MIL value check: waiting for tolerance letter selection.</div>
          </div>
          <div class="group"><p class="group-title">Tolerance / Multiplier Letter Code</p><div id="letterFilter" class="pill-cloud"></div></div>
          <div class="group">
            <p class="group-title">MIL Value/Tolerance Table Used For Check</p>
            <table class="mini-table">
              <thead>
                <tr><th>Tolerance</th><th>Series</th><th>Allowed 3-digit Mantissas</th></tr>
              </thead>
              <tbody>
                <tr><td>0.1%, 0.25%, 0.5%, 1%</td><td>E96</td><td>100..976 preferred set</td></tr>
                <tr><td>2%, 5%</td><td>E24</td><td>100..910 preferred set</td></tr>
                <tr><td>10%</td><td>E12</td><td>100..820 preferred set</td></tr>
              </tbody>
            </table>
          </div>
          <div class="group"><p class="group-title">Failure Rate Code</p><div id="frFilter" class="pill-cloud"></div></div>
          <div class="group"><p class="group-title">Packaging</p><div id="pkgFilter" class="pill-cloud"></div></div>
          <div class="group"><p class="group-title">Thin Film Code</p><div id="tfFilter" class="pill-cloud"></div></div>
          <button id="clearBtn" class="btn" type="button">Clear All Filters</button>
          <div class="hint">
            Letter set included: A B C, R U V, W Y Z, D E F, G H T, J K L, M N P.
          </div>
        </div>
      </aside>

      <section class="panel">
        <h2>Remaining Part Numbers</h2>
        <div class="summary-line">
          <span id="statusText">Ready</span>
          <strong id="resultCount">0 matches</strong>
        </div>
        <div id="results" class="results"></div>
      </section>
    </section>
    </section>

    <section id="t502View" class="component-view hidden">
      <section class="pn-bar">
        <div class="pn-label">Selected PN</div>
        <div id="t502PnBarText" class="pn-text">T502-?-???-?-??-??</div>
        <div class="pn-help">Prototype format: Series + Case + CapCode + Tol + Voltage + Pack</div>
      </section>

      <section class="main">
        <aside class="panel">
          <h2>T502 Filters</h2>
          <div class="panel-body">
            <div class="group">
              <p class="group-title">Series</p>
              <div class="pill-cloud"><span class="filter-pill active">T502</span></div>
            </div>
            <div class="hint">T502 case set uses B/C/D molded tantalum outlines.</div>
            <div class="group"><p class="group-title">Case</p><div id="t502CaseFilter" class="pill-cloud"></div></div>
            <div class="group">
              <p class="group-title">Capacitance (uF)</p>
              <div id="t502CapFilter" class="pill-cloud"></div>
              <div id="t502CapHint" class="hint">Select capacitance from table options.</div>
            </div>
            <div class="group"><p class="group-title">Voltage</p><div id="t502VoltFilter" class="pill-cloud"></div></div>
            <div class="group">
              <p class="group-title">Code (1) Substitution</p>
              <input id="t502Code1Input" class="text-input" type="text" value="K" />
              <div class="hint">Replaces <span style="font-family:var(--mono)">(1)</span> in table PN pattern.</div>
            </div>
            <div class="group">
              <p class="group-title">Code (2) Substitution</p>
              <input id="t502Code2Input" class="text-input" type="text" value="R" />
              <div class="hint">Replaces <span style="font-family:var(--mono)">(2)</span> in table PN pattern.</div>
            </div>
            <button id="t502ClearBtn" class="btn" type="button">Clear T502 Filters</button>
          </div>
        </aside>
        <section class="panel">
          <h2>T502 Results</h2>
          <div class="summary-line">
            <span id="t502StatusText">Prototype generator active</span>
            <strong id="t502ResultCount">1 result</strong>
          </div>
          <div id="t502Results" class="results"></div>
        </section>
      </section>
    </section>
  </div>

  <script>
    // Datasheet field dictionary: model designator.
    // Keep these as explicit code keys because they directly map into the PN string.
    const modelOptions = [
      { key: "M55342", label: "M55342" },
      { key: "D55342", label: "D55342" }
    ];
    // TCR code map used in the MIL-style PN composition.
    const tcrOptions = [
      { key: "E", label: "E (25 ppm/C)" },
      { key: "H", label: "H (50 ppm/C)" },
      { key: "K", label: "K (100 ppm/C)" },
      { key: "L", label: "L (150 ppm/C)" },
      { key: "M", label: "M (200 ppm/C)" }
    ];
    // Case/slash code mapping from reviewed dataset:
    // 01=0502, 02=0505, 03=1005, 04=1505, 05=2208, 06=0805,
    // 07=1206, 08=2010, 09=2512, 10=1010, 11=0402, 12=0603.
    // Power/operating-voltage values below come from the user-provided
    // M55342/D55342 table in this review thread.
    const sizeOptions = [
      { key: "01", footprint: "0502", powerMw: 50, opV: 40, label: "/01 (0502, 50 mW, 40 V op)" },
      { key: "02", footprint: "0505", powerMw: 125, opV: 40, label: "/02 (0505, 125 mW, 40 V op)" },
      { key: "03", footprint: "1005", powerMw: 200, opV: 75, label: "/03 (1005, 200 mW, 75 V op)" },
      { key: "04", footprint: "1505", powerMw: 150, opV: 125, label: "/04 (1505, 150 mW, 125 V op)" },
      { key: "05", footprint: "2208", powerMw: 225, opV: 175, label: "/05 (2208, 225 mW, 175 V op)" },
      { key: "06", footprint: "0805", powerMw: 150, opV: 50, label: "/06 (0805, 150 mW, 50 V op)" },
      { key: "07", footprint: "1206", powerMw: 250, opV: 100, label: "/07 (1206, 250 mW, 100 V op)" },
      { key: "08", footprint: "2010", powerMw: 800, opV: 150, label: "/08 (2010, 800 mW, 150 V op)" },
      { key: "09", footprint: "2512", powerMw: 1000, opV: 200, label: "/09 (2512, 1000 mW, 200 V op)" },
      { key: "10", footprint: "1010", powerMw: 500, opV: 75, label: "/10 (1010, 500 mW, 75 V op)" },
      { key: "11", footprint: "0402", powerMw: 50, opV: 30, label: "/11 (0402, 50 mW, 30 V op)" },
      { key: "12", footprint: "0603", powerMw: 100, opV: 50, label: "/12 (0603, 100 mW, 50 V op)" }
    ];
    // Termination code map (kept explicit even though only one option is active).
    const terminationOptions = [{ key: "B", label: "B" }];
    // Value-code letter map:
    // - letter encodes both tolerance class and decimal/multiplier bucket.
    // - digits come from user-entered 3-digit mantissa pattern.
    const letterOptions = [
      { key: "A", tol: "0.1%", mult: 1 }, { key: "B", tol: "0.1%", mult: 1e3 }, { key: "C", tol: "0.1%", mult: 1e6 },
      { key: "R", tol: "0.25%", mult: 1 }, { key: "U", tol: "0.25%", mult: 1e3 }, { key: "V", tol: "0.25%", mult: 1e6 },
      { key: "W", tol: "0.5%", mult: 1 }, { key: "Y", tol: "0.5%", mult: 1e3 }, { key: "Z", tol: "0.5%", mult: 1e6 },
      { key: "D", tol: "1%", mult: 1 }, { key: "E", tol: "1%", mult: 1e3 }, { key: "F", tol: "1%", mult: 1e6 },
      { key: "G", tol: "2%", mult: 1 }, { key: "H", tol: "2%", mult: 1e3 }, { key: "T", tol: "2%", mult: 1e6 },
      { key: "J", tol: "5%", mult: 1 }, { key: "K", tol: "5%", mult: 1e3 }, { key: "L", tol: "5%", mult: 1e6 },
      { key: "M", tol: "10%", mult: 1 }, { key: "N", tol: "10%", mult: 1e3 }, { key: "P", tol: "10%", mult: 1e6 }
    ].map((x) => ({ ...x, label: x.key + " (" + x.tol + ", x" + formatMultiplier(x.mult) + ")" }));

    // Failure-rate code descriptions (percent per 1000 hours at rated conditions).
    const failureRateOptions = [
      { key: "M", label: "M (1.0% / 1000h)" },
      { key: "P", label: "P (0.1% / 1000h)" },
      { key: "R", label: "R (0.01% / 1000h)" },
      { key: "U", label: "U (0.001% / 1000h)" },
      { key: "S", label: "S (0.005% / 1000h)" },
      { key: "V", label: "V (0.0001% / 1000h)" },
      { key: "C", label: "C (non-ER / commercial style)" }
    ];
    // Packaging code descriptions as shown in procurement tables.
    const packagingOptions = [
      { key: "BS", label: "BS (bulk, 100 pcs)" },
      { key: "WS", label: "WS (waffle, 100 pcs)" },
      { key: "W0", label: "W0 (waffle, 1000 pcs)" },
      { key: "T0", label: "T0 (tape, 100 pcs)" },
      { key: "T1", label: "T1 (tape, 1000 pcs)" },
      { key: "T3", label: "T3 (tape, 3000 pcs)" },
      { key: "T5", label: "T5 (tape, 5000 pcs)" },
      { key: "TF", label: "TF (tape, full reel)" },
      { key: "TS", label: "TS (tape, small reel)" },
      { key: "WI", label: "WI (waffle, isolated)" },
      { key: "WP", label: "WP (waffle, qty by size)" },
      { key: "TI", label: "TI (tape, isolated)" },
      { key: "TP", label: "TP (tape, qty by size)" }
    ];
    // Thin-film suffix behavior notes.
    const thinFilmOptions = [
      { key: "", label: "(none) (standard construction)" },
      { key: "V", label: "V (thin film style; constrained by TCR/tolerance rule)" },
      { key: "M", label: "M (part marking / marking-required option)" }
    ];

    const filters = {
      model: "M55342",
      tcr: "K",
      size: "06",
      termination: "B",
      letter: "E",
      failure: "R",
      packaging: "WS",
      thinFilm: null
    };

    const nodes = {
      componentButtons: Array.from(document.querySelectorAll(".component-btn[data-component]")),
      m55342View: document.getElementById("m55342View"),
      t502View: document.getElementById("t502View"),
      model: document.getElementById("modelFilter"),
      tcr: document.getElementById("tcrFilter"),
      size: document.getElementById("sizeFilter"),
      termination: document.getElementById("termFilter"),
      letter: document.getElementById("letterFilter"),
      failure: document.getElementById("frFilter"),
      packaging: document.getElementById("pkgFilter"),
      thinFilm: document.getElementById("tfFilter"),
      resInput: document.getElementById("resInput"),
      resHint: document.getElementById("resHint"),
      milHint: document.getElementById("milHint"),
      results: document.getElementById("results"),
      resultCount: document.getElementById("resultCount"),
      statusText: document.getElementById("statusText"),
      clearBtn: document.getElementById("clearBtn"),
      pnBarText: document.getElementById("pnBarText")
    };

    // Initial T502 workspace state and code dictionaries.
    // This is intentionally a first-pass model for iterative refinement.
    const t502State = {
      caseSize: "D",
      capacitanceUf: "22",
      voltage: "16",
      code1: "K",
      code2: "R"
    };

    const t502Options = {
      // T502 case mapping (from provided table rows).
      caseSize: [
        { key: "B", label: "B (EIA 3528-21, 3.5 x 2.8 x 2.1 mm)" },
        { key: "C", label: "C (EIA 6032-28, 6.0 x 3.2 x 2.8 mm)" },
        { key: "D", label: "D (EIA 7343-31, 7.3 x 4.3 x 3.1 mm)" }
      ],
      voltage: [
        { key: "16", label: "16 V" }, { key: "20", label: "20 V" }, { key: "25", label: "25 V" }, { key: "35", label: "35 V" }
      ]
    };

    // T502 rows encoded directly from user-provided table for deterministic matching.
    const t502Rows = [
      { v: "16", cap: 10, case: "B", outline: "3528-21", pattern: "T502B106(1)016AG(2)10", dcl: "1.6", df: "6", esr: "2.8", ripple: "174", surge: "230" },
      { v: "16", cap: 33, case: "D", outline: "7343-31", pattern: "T502D336(1)016AG(2)10", dcl: "5.3", df: "6", esr: "0.7", ripple: "460", surge: "230" },
      { v: "20", cap: 4.7, case: "C", outline: "6032-28", pattern: "T502C475(1)020AG(2)10", dcl: "0.9", df: "6", esr: "2.0", ripple: "235", surge: "230" },
      { v: "20", cap: 10, case: "C", outline: "6032-28", pattern: "T502C106(1)020AG(2)10", dcl: "2.0", df: "6", esr: "1.5", ripple: "271", surge: "230" },
      { v: "20", cap: 22, case: "D", outline: "7343-31", pattern: "T502D226(1)020AG(2)10", dcl: "4.4", df: "6", esr: "0.7", ripple: "460", surge: "230" },
      { v: "20", cap: 33, case: "D", outline: "7343-31", pattern: "T502D336(1)020AG(2)10", dcl: "6.6", df: "6", esr: "0.7", ripple: "460", surge: "230" },
      { v: "25", cap: 4.7, case: "C", outline: "6032-28", pattern: "T502C475(1)025AG(2)10", dcl: "1.2", df: "6", esr: "2.0", ripple: "235", surge: "230" },
      { v: "25", cap: 6.8, case: "C", outline: "6032-28", pattern: "T502C685(1)025AG(2)10", dcl: "1.7", df: "6", esr: "1.9", ripple: "271", surge: "230" },
      { v: "25", cap: 10, case: "C", outline: "6032-28", pattern: "T502C106(1)025AG(2)10", dcl: "2.5", df: "6", esr: "1.5", ripple: "271", surge: "230" },
      { v: "25", cap: 10, case: "D", outline: "7343-31", pattern: "T502D106(1)025AG(2)10", dcl: "2.5", df: "6", esr: "1.8", ripple: "289", surge: "230" },
      { v: "25", cap: 15, case: "D", outline: "7343-31", pattern: "T502D156(1)025AG(2)10", dcl: "3.8", df: "6", esr: "0.7", ripple: "460", surge: "230" },
      { v: "25", cap: 22, case: "D", outline: "7343-31", pattern: "T502D226(1)025AG(2)10", dcl: "5.5", df: "6", esr: "0.7", ripple: "460", surge: "230" },
      { v: "25", cap: 33, case: "D", outline: "7343-31", pattern: "T502D336(1)025AG(2)10", dcl: "8.3", df: "6", esr: "0.7", ripple: "460", surge: "230" },
      { v: "35", cap: 4.7, case: "C", outline: "6032-28", pattern: "T502C475(1)035AG(2)10", dcl: "1.7", df: "6", esr: "2.0", ripple: "235", surge: "230" },
      { v: "35", cap: 6.8, case: "D", outline: "7343-31", pattern: "T502D685(1)035AG(2)10", dcl: "2.4", df: "6", esr: "1.8", ripple: "289", surge: "230" },
      { v: "35", cap: 10, case: "D", outline: "7343-31", pattern: "T502D106(1)035AG(2)10", dcl: "3.5", df: "6", esr: "1.0", ripple: "390", surge: "230" },
      { v: "35", cap: 15, case: "D", outline: "7343-31", pattern: "T502D156(1)035AG(2)10", dcl: "5.3", df: "6", esr: "0.7", ripple: "460", surge: "230" },
      { v: "35", cap: 22, case: "D", outline: "7343-31", pattern: "T502D226(1)035AG(2)10", dcl: "7.7", df: "6", esr: "0.7", ripple: "460", surge: "230" }
    ];

    const t502Nodes = {
      caseSize: document.getElementById("t502CaseFilter"),
      capFilter: document.getElementById("t502CapFilter"),
      capHint: document.getElementById("t502CapHint"),
      voltage: document.getElementById("t502VoltFilter"),
      code1Input: document.getElementById("t502Code1Input"),
      code2Input: document.getElementById("t502Code2Input"),
      clearBtn: document.getElementById("t502ClearBtn"),
      pnText: document.getElementById("t502PnBarText"),
      statusText: document.getElementById("t502StatusText"),
      resultCount: document.getElementById("t502ResultCount"),
      results: document.getElementById("t502Results")
    };

    // Derived capacitance options from the provided T502 row set.
    const t502CapOptions = Array.from(new Set(t502Rows.map((r) => String(r.cap))))
      .sort((a, b) => Number(a) - Number(b))
      .map((c) => ({ key: c, label: c + " uF" }));

    function formatMultiplier(v) {
      if (v === 1) return "1";
      if (v === 1e3) return "1k";
      if (v === 1e6) return "1M";
      return String(v);
    }

    function parseMantissa(input) {
      const s = String(input || "").trim();
      const m = s.match(/^(\.[0-9]{3}|[0-9]\.[0-9]{2}|[0-9]{2}\.[0-9]|[0-9]{3}\.)$/);
      if (!m) return null;
      const dotIndex = s.indexOf(".");
      const digits = s.replace(".", "");
      return {
        raw: s,
        dotIndex,
        digits,
        value: Number(s)
      };
    }

    function updateInputFormatting() {
      const parsed = parseMantissa(nodes.resInput.value);
      nodes.resInput.classList.remove("valid", "invalid");
      if (parsed) {
        nodes.resInput.classList.add("valid");
        nodes.resHint.textContent = "Valid format. Unselected letter preview: " + parsed.raw.replace(".", "_");
      } else {
        nodes.resInput.classList.add("invalid");
        nodes.resHint.textContent = "Invalid format. Use three digits with decimal point (.560, 5.60, 56.0, or 560.).";
      }
      return parsed;
    }

    function letterInfo(key) {
      return letterOptions.find((x) => x.key === key) || null;
    }

    // MIL preferred value tables represented as 3-digit mantissa integers.
    // Example: 5.60 => mantissa 560.
    // Trace refs:
    // - MIL part-number/value examples in MIL-PRF-55342 slash-sheet tables (NASA NPSL mirror)
    // - Vishay E/H M/D55342 global PN table (eh.pdf): letter/tolerance/multiplier definition
    const MIL_SERIES_E96 = new Set([
      100,102,105,107,110,113,115,118,121,124,127,130,133,137,140,143,147,150,154,158,162,165,169,174,
      178,182,187,191,196,200,205,210,215,221,226,232,237,243,249,255,261,267,274,280,287,294,301,309,
      316,324,332,340,348,357,365,374,383,392,402,412,422,432,442,453,464,475,487,499,511,523,536,549,
      562,576,590,604,619,634,649,665,681,698,715,732,750,768,787,806,825,845,866,887,909,931,953,976
    ]);
    const MIL_SERIES_E24 = new Set([100,110,120,130,150,160,180,200,220,240,270,300,330,360,390,430,470,510,560,620,680,750,820,910]);
    const MIL_SERIES_E12 = new Set([100,120,150,180,220,270,330,390,470,560,680,820]);

    function selectMilSeriesByTolerance(tolPercent) {
      const t = Number(String(tolPercent || "").replace("%", ""));
      if (!isFinite(t)) return null;
      if (t <= 1) return MIL_SERIES_E96;
      if (t <= 5) return MIL_SERIES_E24;
      return MIL_SERIES_E12;
    }

    function milValueCheck(mantissa, letterKey) {
      if (!mantissa) return { ok: false, message: "MIL check: invalid resistance input format." };
      if (!letterKey) return { ok: null, message: "MIL check: select a tolerance letter to validate value membership." };
      const li = letterInfo(letterKey);
      if (!li) return { ok: false, message: "MIL check: unknown tolerance letter." };
      const series = selectMilSeriesByTolerance(li.tol);
      if (!series) return { ok: false, message: "MIL check: no series mapping for selected tolerance." };
      const digits = Number(mantissa.digits);
      const inSeries = series.has(digits);
      if (inSeries) {
        return { ok: true, message: "MIL check: in spec for " + li.tol + " tolerance (" + digits + " mantissa in allowed series)." };
      }
      return { ok: false, message: "MIL check: out of spec for " + li.tol + " tolerance (" + digits + " mantissa not in allowed series)." };
    }

    // Resolve slash-code electrical data for display in results and reviewer checks.
    function sizeInfo(key) {
      return sizeOptions.find((x) => x.key === key) || null;
    }

    function buildValueCode(mantissa, letterKey) {
      const li = letterInfo(letterKey);
      if (!li || !mantissa) return null;
      const mil = milValueCheck(mantissa, letterKey);
      if (mil.ok !== true) return null;
      const code = mantissa.digits.slice(0, mantissa.dotIndex) + li.key + mantissa.digits.slice(mantissa.dotIndex);
      const nominal = mantissa.value * li.mult;
      const errorPct = 0;
      return { code, nominal, errorPct, tol: li.tol };
    }

    function isValidRow(r) {
      if (r.thinFilm === "V") {
        const t = Number(r.letterTol.replace("%", ""));
        if (!(r.tcr === "K" || r.tcr === "L" || r.tcr === "M")) return false;
        if (!(t >= 1)) return false;
      }
      if (r.thinFilm === "M" && (r.size === "01" || r.size === "02" || r.size === "11" || r.size === "12")) {
        return false;
      }
      return true;
    }

    function selectedOrAll(key, options, localFilters) {
      const sel = localFilters[key];
      return sel === null ? options : options.filter((x) => x.key === sel);
    }

    function generateRows(localFilters) {
      const mantissa = parseMantissa(nodes.resInput.value);
      if (!mantissa) return [];

      const rows = [];
      const ms = selectedOrAll("model", modelOptions, localFilters);
      const ts = selectedOrAll("tcr", tcrOptions, localFilters);
      const ss = selectedOrAll("size", sizeOptions, localFilters);
      const terms = selectedOrAll("termination", terminationOptions, localFilters);
      const ls = selectedOrAll("letter", letterOptions, localFilters);
      const frs = selectedOrAll("failure", failureRateOptions, localFilters);
      const pkgs = selectedOrAll("packaging", packagingOptions, localFilters);
      const tfs = selectedOrAll("thinFilm", thinFilmOptions, localFilters);

      for (const m of ms) {
        for (const t of ts) {
          for (const s of ss) {
            for (const term of terms) {
              for (const l of ls) {
                const vc = buildValueCode(mantissa, l.key);
                if (!vc) continue;
                for (const fr of frs) {
                  for (const p of pkgs) {
                    for (const tf of tfs) {
                      const row = {
                        model: m.key,
                        tcr: t.key,
                        size: s.key,
                        termination: term.key,
                        letter: l.key,
                        letterTol: l.tol,
                        valueCode: vc.code,
                        valueNominal: vc.nominal,
                        valueErrorPct: vc.errorPct,
                        failure: fr.key,
                        packaging: p.key,
                        thinFilm: tf.key
                      };
                      if (!isValidRow(row)) continue;
                      row.pn = row.model + row.tcr + row.size + row.termination + row.valueCode + row.failure + row.packaging + row.thinFilm;
                      rows.push(row);
                    }
                  }
                }
              }
            }
          }
        }
      }
      return rows;
    }

    function matches(optionKey, optionVal) {
      const test = { ...filters, [optionKey]: optionVal };
      return generateRows(test).length;
    }

    function renderFilterGroup(key, host, options) {
      host.innerHTML = "";
      for (const opt of options) {
        const count = matches(key, opt.key);
        const pill = document.createElement("button");
        pill.type = "button";
        pill.className = "filter-pill";
        if (filters[key] === opt.key) pill.classList.add("active");
        if (count === 0) pill.classList.add("disabled");
        pill.disabled = count === 0 && filters[key] !== opt.key;
        pill.innerHTML = "<span>" + opt.label + "</span><span class=\"count\">" + count + "</span>";
        pill.addEventListener("click", () => {
          filters[key] = (filters[key] === opt.key) ? null : opt.key;
          renderAll();
        });
        host.appendChild(pill);
      }
    }

    function updatePnBar() {
      const mantissa = parseMantissa(nodes.resInput.value);
      const vc = (filters.letter && mantissa) ? buildValueCode(mantissa, filters.letter) : null;
      const valueSegment = vc
        ? vc.code
        : (mantissa ? mantissa.raw.replace(".", "_") : "____");
      const pn =
        (filters.model || "M55342") +
        (filters.tcr || "_") +
        (filters.size || "__") +
        (filters.termination || "_") +
        valueSegment +
        (filters.failure || "_") +
        (filters.packaging || "__") +
        (filters.thinFilm === null ? "_" : (filters.thinFilm === "" ? "-" : filters.thinFilm));
      nodes.pnBarText.textContent = pn;
    }

    function renderResults() {
      const rows = generateRows(filters);
      nodes.resultCount.textContent = rows.length + " matches";
      nodes.statusText.textContent = rows.length ? "Filtered datasheet-code combinations" : "No matching combination";
      nodes.results.innerHTML = "";

      if (!rows.length) {
        const empty = document.createElement("div");
        empty.className = "result-card";
        empty.innerHTML = "<div class=\"pn\">No valid part numbers for current selections/resistance input.</div>";
        nodes.results.appendChild(empty);
        return;
      }

      const maxShown = 300;
      for (const row of rows.slice(0, maxShown)) {
        const sz = sizeInfo(row.size);
        const card = document.createElement("article");
        card.className = "result-card";
        card.innerHTML =
          "<div class=\"pn\">" + row.pn + "</div>" +
          "<div class=\"meta\">" +
          "<span>Slash: /" + row.size + (sz ? (" (" + sz.footprint + ")") : "") + "</span>" +
          "<span>Power: " + (sz ? (sz.powerMw + " mW") : "N/A") + "</span>" +
          "<span>V op: " + (sz ? (sz.opV + " V") : "N/A") + "</span>" +
          "<span>Value Code: " + row.valueCode + "</span>" +
          "<span>Letter: " + row.letter + " (" + row.letterTol + ")</span>" +
          "<span>Rounded: " + formatOhms(row.valueNominal) + "</span>" +
          "<span>Error: " + row.valueErrorPct.toFixed(2) + "%</span>" +
          "</div>";
        nodes.results.appendChild(card);
      }
      if (rows.length > maxShown) {
        const more = document.createElement("div");
        more.className = "result-card";
        more.innerHTML = "<div class=\"pn\">Showing first " + maxShown + " of " + rows.length + " matches.</div>";
        nodes.results.appendChild(more);
      }
    }

    function formatOhms(v) {
      if (v >= 1e6) return (v / 1e6).toFixed(3).replace(/\.?0+$/, "") + " Mohm";
      if (v >= 1e3) return (v / 1e3).toFixed(3).replace(/\.?0+$/, "") + " kohm";
      return v.toFixed(3).replace(/\.?0+$/, "") + " ohm";
    }

    function renderT502FilterGroup(host, options, selectedKey, onSelect) {
      host.innerHTML = "";
      for (const opt of options) {
        const b = document.createElement("button");
        b.type = "button";
        b.className = "filter-pill" + (selectedKey === opt.key ? " active" : "");
        b.innerHTML = "<span>" + opt.label + "</span>";
        b.addEventListener("click", () => onSelect(opt.key));
        host.appendChild(b);
      }
    }

    function findMatchingT502Rows() {
      const cap = Number(String(t502State.capacitanceUf || "").trim());
      if (!isFinite(cap) || cap <= 0) return [];
      return t502Rows.filter((r) =>
        r.case === t502State.caseSize &&
        r.v === t502State.voltage &&
        Math.abs(r.cap - cap) < 1e-9
      );
    }

    function applyT502Substitutions(pattern) {
      return pattern
        .replace("(1)", t502State.code1 || "_")
        .replace("(2)", t502State.code2 || "_");
    }

    function renderT502() {
      renderT502FilterGroup(t502Nodes.caseSize, t502Options.caseSize, t502State.caseSize, (k) => { t502State.caseSize = k; renderT502(); });
      renderT502FilterGroup(t502Nodes.capFilter, t502CapOptions, String(t502State.capacitanceUf), (k) => { t502State.capacitanceUf = k; renderT502(); });
      renderT502FilterGroup(t502Nodes.voltage, t502Options.voltage, t502State.voltage, (k) => { t502State.voltage = k; renderT502(); });
      const matches = findMatchingT502Rows();
      if (matches.length > 0) {
        const codes = Array.from(new Set(matches.map((m) => m.pattern.match(/T502[A-Z](\d{3})/)?.[1]).filter(Boolean)));
        t502Nodes.capHint.textContent = "Matched table row(s): " + matches.length + " (" + codes.join(", ") + ").";
        t502Nodes.capHint.classList.remove("bad");
        t502Nodes.capHint.classList.add("ok");
      } else {
        t502Nodes.capHint.textContent = "No exact table row for selected Case/Voltage/Capacitance.";
        t502Nodes.capHint.classList.remove("ok");
        t502Nodes.capHint.classList.add("bad");
      }

      const pn = matches.length ? applyT502Substitutions(matches[0].pattern) : "T502-?-???-?-??-??";
      t502Nodes.pnText.textContent = pn;
      t502Nodes.results.innerHTML = "";

      if (!matches.length) {
        t502Nodes.resultCount.textContent = "0 results";
        t502Nodes.statusText.textContent = "No table match";
        const empty = document.createElement("div");
        empty.className = "result-card";
        empty.innerHTML = "<div class=\"pn\">No encoded row for this Case + Voltage + Capacitance combination.</div>";
        t502Nodes.results.appendChild(empty);
        return;
      }

      t502Nodes.resultCount.textContent = matches.length + " result" + (matches.length === 1 ? "" : "s");
      t502Nodes.statusText.textContent = "Table-driven T502 mapping";
      const caseInfo = t502Options.caseSize.find((x) => x.key === t502State.caseSize);

      for (const row of matches) {
        const filledPn = applyT502Substitutions(row.pattern);
        const card = document.createElement("article");
        card.className = "result-card";
        card.innerHTML =
          "<div class=\"pn\">" + filledPn + "</div>" +
          "<div class=\"meta\">" +
          "<span>Pattern: " + row.pattern + "</span>" +
          "<span>Case: " + (caseInfo ? caseInfo.label : row.case) + "</span>" +
          "<span>Cap: " + row.cap + " uF</span>" +
          "<span>Volt: " + row.v + " V</span>" +
          "<span>DCL: " + row.dcl + "</span>" +
          "<span>DF: " + row.df + "</span>" +
          "<span>ESR: " + row.esr + "</span>" +
          "<span>Ripple: " + row.ripple + "</span>" +
          "<span>Surge: " + row.surge + "</span>" +
          "</div>";
        t502Nodes.results.appendChild(card);
      }
    }

    function setComponentView(viewKey) {
      const isM55342 = viewKey === "m55342";
      nodes.m55342View.classList.toggle("hidden", !isM55342);
      nodes.t502View.classList.toggle("hidden", isM55342);
      for (const b of nodes.componentButtons) {
        b.classList.toggle("active", b.dataset.component === viewKey);
      }
    }

    function renderAll() {
      const mantissa = updateInputFormatting();
      const mil = milValueCheck(mantissa, filters.letter);
      nodes.milHint.textContent = mil.message;
      nodes.milHint.classList.remove("ok", "bad");
      if (mil.ok === true) nodes.milHint.classList.add("ok");
      if (mil.ok === false) nodes.milHint.classList.add("bad");
      renderFilterGroup("model", nodes.model, modelOptions);
      renderFilterGroup("tcr", nodes.tcr, tcrOptions);
      renderFilterGroup("size", nodes.size, sizeOptions);
      renderFilterGroup("termination", nodes.termination, terminationOptions);
      renderFilterGroup("letter", nodes.letter, letterOptions);
      renderFilterGroup("failure", nodes.failure, failureRateOptions);
      renderFilterGroup("packaging", nodes.packaging, packagingOptions);
      renderFilterGroup("thinFilm", nodes.thinFilm, thinFilmOptions);
      updatePnBar();
      renderResults();
    }

    nodes.clearBtn.addEventListener("click", () => {
      filters.model = null;
      filters.tcr = null;
      filters.size = null;
      filters.termination = null;
      filters.letter = null;
      filters.failure = null;
      filters.packaging = null;
      filters.thinFilm = null;
      renderAll();
    });

    for (const b of nodes.componentButtons) {
      b.addEventListener("click", () => setComponentView(b.dataset.component));
    }

    nodes.resInput.addEventListener("input", renderAll);
    t502Nodes.code1Input.addEventListener("input", () => {
      t502State.code1 = t502Nodes.code1Input.value.trim().toUpperCase();
      renderT502();
    });
    t502Nodes.code2Input.addEventListener("input", () => {
      t502State.code2 = t502Nodes.code2Input.value.trim().toUpperCase();
      renderT502();
    });
    t502Nodes.clearBtn.addEventListener("click", () => {
      t502State.caseSize = "D";
      t502State.capacitanceUf = "22";
      t502State.voltage = "16";
      t502State.code1 = "K";
      t502State.code2 = "R";
      t502Nodes.code1Input.value = t502State.code1;
      t502Nodes.code2Input.value = t502State.code2;
      renderT502();
    });

    renderAll();
    renderT502();
    setComponentView("m55342");
  </script>
</body>
</html>

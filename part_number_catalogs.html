<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>M55342 / D55342 Part Number Generator</title>
  <style>
    :root {
      --bg: #0e1118;
      --panel: #151b25;
      --text: #e8edf5;
      --muted: #98a7bb;
      --border: #2d3a4d;
      --shadow: 0 8px 28px rgba(0, 0, 0, 0.35);
      --mono: "Consolas", "Courier New", monospace;
      --sans: "Segoe UI", "Trebuchet MS", sans-serif;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(circle at 20% 0%, #1b2434 0%, transparent 50%),
        radial-gradient(circle at 90% 100%, #132036 0%, transparent 45%),
        var(--bg);
      min-height: 100vh;
    }

    .page {
      width: min(1920px, calc(100vw - 24px));
      margin: 0 auto;
      padding: 16px;
      display: grid;
      grid-template-rows: auto auto 1fr;
      gap: 12px;
      min-height: 100vh;
    }

    .header, .pn-bar, .panel {
      border: 1px solid var(--border);
      background: var(--panel);
      border-radius: 12px;
      box-shadow: var(--shadow);
    }

    .header { padding: 14px; }
    .title { margin: 0; font-size: 1.2rem; letter-spacing: 0.02em; }
    .subtitle { margin: 6px 0 0; color: var(--muted); font-size: 0.9rem; }

    .pn-bar {
      padding: 10px 12px;
      display: grid;
      grid-template-columns: auto 1fr auto;
      gap: 10px;
      align-items: center;
      background: #101823;
    }

    .pn-label {
      font-size: 0.78rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .pn-text {
      font-family: var(--mono);
      font-size: 0.98rem;
      color: #c6e3ff;
      overflow-x: auto;
      white-space: nowrap;
    }

    .pn-help {
      font-size: 0.78rem;
      color: var(--muted);
      text-align: right;
      white-space: nowrap;
    }

    .main {
      display: grid;
      grid-template-columns: minmax(360px, 36%) minmax(420px, 64%);
      gap: 12px;
      min-height: 0;
    }

    .panel {
      overflow: hidden;
      min-height: 0;
      display: flex;
      flex-direction: column;
    }

    .panel h2 {
      margin: 0;
      padding: 10px 12px;
      font-size: 1rem;
      border-bottom: 1px solid var(--border);
      background: #1a2230;
    }

    .panel-body { padding: 10px; overflow: auto; }

    .group {
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #101823;
      padding: 10px;
      margin-bottom: 10px;
    }

    .group-title {
      margin: 0 0 8px;
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--muted);
    }

    .pill-cloud {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .filter-pill {
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 6px 11px;
      font-size: 0.8rem;
      color: var(--text);
      background: #1a2638;
      cursor: pointer;
      user-select: none;
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      line-height: 1.2;
    }

    .filter-pill .count {
      color: var(--muted);
      font-size: 0.74rem;
      font-family: var(--mono);
    }

    .filter-pill.active {
      border-color: rgba(102, 163, 255, 0.7);
      background: rgba(102, 163, 255, 0.2);
      color: #d9ebff;
      box-shadow: inset 0 0 0 1px rgba(102, 163, 255, 0.28);
      font-weight: 700;
    }

    .filter-pill.disabled {
      opacity: 0.45;
      cursor: not-allowed;
    }

    .text-input {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: 8px;
      min-height: 36px;
      background: #1e2837;
      color: var(--text);
      padding: 0 10px;
      font-family: var(--mono);
      font-size: 0.88rem;
    }

    .hint { margin-top: 6px; color: var(--muted); font-size: 0.78rem; }

    .btn {
      border: 1px solid var(--border);
      background: #1e2837;
      color: var(--text);
      border-radius: 8px;
      min-height: 34px;
      padding: 0 10px;
      cursor: pointer;
      font-size: 0.82rem;
    }

    .summary-line {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: center;
      border-bottom: 1px solid var(--border);
      padding: 10px 12px;
      color: var(--muted);
      font-size: 0.88rem;
      background: #1a2230;
    }

    .summary-line strong {
      color: var(--text);
      font-family: var(--mono);
      font-size: 0.95rem;
    }

    .results {
      overflow: auto;
      padding: 10px;
      display: grid;
      gap: 8px;
      align-content: start;
    }

    .result-card {
      border: 1px solid var(--border);
      background: #101823;
      border-radius: 10px;
      padding: 9px 11px;
    }

    .pn {
      font-family: var(--mono);
      font-weight: 700;
      color: #c6e3ff;
      word-break: break-all;
      font-size: 0.94rem;
    }

    .meta {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 7px;
      color: var(--muted);
      font-size: 0.78rem;
    }

    .meta span {
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 3px 8px;
      background: #142033;
    }

    @media (max-width: 980px) {
      .pn-bar { grid-template-columns: 1fr; }
      .pn-help { text-align: left; white-space: normal; }
      .main { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="page">
    <section class="header">
      <h1 class="title">M55342 / D55342 Part Number Generator</h1>
      <p class="subtitle">Resistance code now follows the datasheet style: three digits + one letter. Letter sets tolerance and multiplier/decimal location.</p>
    </section>

    <section class="pn-bar">
      <div class="pn-label">Selected PN</div>
      <div id="pnBarText" class="pn-text">M55342_ _ _ _ _ _ _</div>
      <div class="pn-help">Format: Model + TCR + Case + Term + ValueCode + FR + Pack + ThinFilm</div>
    </section>

    <section class="main">
      <aside class="panel">
        <h2>Filters</h2>
        <div class="panel-body">
          <div class="group"><p class="group-title">Model</p><div id="modelFilter" class="pill-cloud"></div></div>
          <div class="group"><p class="group-title">TCR Code</p><div id="tcrFilter" class="pill-cloud"></div></div>
          <div class="group"><p class="group-title">Case Size / Slash</p><div id="sizeFilter" class="pill-cloud"></div></div>
          <div class="group"><p class="group-title">Termination</p><div id="termFilter" class="pill-cloud"></div></div>
          <div class="group">
            <p class="group-title">Resistance Input (Ohms)</p>
            <input id="resInput" class="text-input" type="text" value="560k" />
            <div class="hint">Examples: <span style="font-family:var(--mono)">560</span>, <span style="font-family:var(--mono)">16.67k</span>, <span style="font-family:var(--mono)">1M</span></div>
          </div>
          <div class="group"><p class="group-title">Tolerance / Multiplier Letter Code</p><div id="letterFilter" class="pill-cloud"></div></div>
          <div class="group"><p class="group-title">Failure Rate Code</p><div id="frFilter" class="pill-cloud"></div></div>
          <div class="group"><p class="group-title">Packaging</p><div id="pkgFilter" class="pill-cloud"></div></div>
          <div class="group"><p class="group-title">Thin Film Code</p><div id="tfFilter" class="pill-cloud"></div></div>
          <button id="clearBtn" class="btn" type="button">Clear All Filters</button>
          <div class="hint">
            Letter set included: A B C, R U V, W Y Z, D E F, G H T, J K L, M N P.
          </div>
        </div>
      </aside>

      <section class="panel">
        <h2>Remaining Part Numbers</h2>
        <div class="summary-line">
          <span id="statusText">Ready</span>
          <strong id="resultCount">0 matches</strong>
        </div>
        <div id="results" class="results"></div>
      </section>
    </section>
  </div>

  <script>
    const modelOptions = [
      { key: "M55342", label: "M55342" },
      { key: "D55342", label: "D55342" }
    ];
    const tcrOptions = [
      { key: "E", label: "E (25 ppm/C)" },
      { key: "H", label: "H (50 ppm/C)" },
      { key: "K", label: "K (100 ppm/C)" },
      { key: "L", label: "L (150 ppm/C)" },
      { key: "M", label: "M (200 ppm/C)" }
    ];
    const sizeOptions = [
      { key: "01", label: "/01" }, { key: "02", label: "/02" }, { key: "03", label: "/03" },
      { key: "04", label: "/04" }, { key: "05", label: "/05" }, { key: "06", label: "/06" },
      { key: "07", label: "/07 (D55342 only)" }, { key: "08", label: "/08" }, { key: "09", label: "/09" },
      { key: "10", label: "/10" }, { key: "11", label: "/11" }, { key: "12", label: "/12" }
    ];
    const terminationOptions = [{ key: "B", label: "B" }];
    const letterOptions = [
      { key: "A", tol: "0.1%", mult: 1 }, { key: "B", tol: "0.1%", mult: 1e3 }, { key: "C", tol: "0.1%", mult: 1e6 },
      { key: "R", tol: "0.25%", mult: 1 }, { key: "U", tol: "0.25%", mult: 1e3 }, { key: "V", tol: "0.25%", mult: 1e6 },
      { key: "W", tol: "0.5%", mult: 1 }, { key: "Y", tol: "0.5%", mult: 1e3 }, { key: "Z", tol: "0.5%", mult: 1e6 },
      { key: "D", tol: "1%", mult: 1 }, { key: "E", tol: "1%", mult: 1e3 }, { key: "F", tol: "1%", mult: 1e6 },
      { key: "G", tol: "2%", mult: 1 }, { key: "H", tol: "2%", mult: 1e3 }, { key: "T", tol: "2%", mult: 1e6 },
      { key: "J", tol: "5%", mult: 1 }, { key: "K", tol: "5%", mult: 1e3 }, { key: "L", tol: "5%", mult: 1e6 },
      { key: "M", tol: "10%", mult: 1 }, { key: "N", tol: "10%", mult: 1e3 }, { key: "P", tol: "10%", mult: 1e6 }
    ].map((x) => ({ ...x, label: x.key + " (" + x.tol + ", x" + formatMultiplier(x.mult) + ")" }));

    const failureRateOptions = [
      { key: "M", label: "M" }, { key: "P", label: "P" }, { key: "R", label: "R" },
      { key: "U", label: "U" }, { key: "S", label: "S" }, { key: "V", label: "V" }, { key: "C", label: "C" }
    ];
    const packagingOptions = [
      { key: "BS", label: "BS" }, { key: "WS", label: "WS" }, { key: "W0", label: "W0" },
      { key: "T0", label: "T0" }, { key: "T1", label: "T1" }, { key: "T3", label: "T3" },
      { key: "T5", label: "T5" }, { key: "TF", label: "TF" }, { key: "TS", label: "TS" },
      { key: "WI", label: "WI" }, { key: "WP", label: "WP" }, { key: "TI", label: "TI" }, { key: "TP", label: "TP" }
    ];
    const thinFilmOptions = [
      { key: "", label: "(none)" },
      { key: "V", label: "V" },
      { key: "M", label: "M" }
    ];

    const filters = {
      model: "M55342",
      tcr: "K",
      size: "06",
      termination: "B",
      letter: "E",
      failure: "R",
      packaging: "WS",
      thinFilm: null
    };

    const nodes = {
      model: document.getElementById("modelFilter"),
      tcr: document.getElementById("tcrFilter"),
      size: document.getElementById("sizeFilter"),
      termination: document.getElementById("termFilter"),
      letter: document.getElementById("letterFilter"),
      failure: document.getElementById("frFilter"),
      packaging: document.getElementById("pkgFilter"),
      thinFilm: document.getElementById("tfFilter"),
      resInput: document.getElementById("resInput"),
      results: document.getElementById("results"),
      resultCount: document.getElementById("resultCount"),
      statusText: document.getElementById("statusText"),
      clearBtn: document.getElementById("clearBtn"),
      pnBarText: document.getElementById("pnBarText")
    };

    function formatMultiplier(v) {
      if (v === 1) return "1";
      if (v === 1e3) return "1k";
      if (v === 1e6) return "1M";
      return String(v);
    }

    function parseResistance(input) {
      const s = String(input || "").trim().toLowerCase().replace(/,/g, "");
      const m = s.match(/^([0-9]*\.?[0-9]+)\s*(m|meg|k|r|ohm|ohms|omega)?$/);
      if (!m) return NaN;
      const n = Number(m[1]);
      if (!isFinite(n)) return NaN;
      const suf = m[2] || "";
      if (suf === "m" || suf === "meg") return n * 1e6;
      if (suf === "k") return n * 1e3;
      return n;
    }

    function letterInfo(key) {
      return letterOptions.find((x) => x.key === key) || null;
    }

    function buildValueCode(ohms, letterKey) {
      const li = letterInfo(letterKey);
      if (!li || !isFinite(ohms) || ohms <= 0) return null;
      const digits = Math.round(ohms / li.mult);
      if (digits < 0 || digits > 999) return null;
      const a = Math.floor(digits / 100);
      const bc = String(digits % 100).padStart(2, "0");
      const code = String(a) + li.key + bc;
      const nominal = digits * li.mult;
      const errorPct = ((nominal - ohms) / ohms) * 100;
      return { code, nominal, errorPct, tol: li.tol };
    }

    function isValidRow(r) {
      if (r.model === "D55342" && r.size !== "07") return false;
      if (r.model === "M55342" && r.size === "07") return false;

      if (r.thinFilm === "V") {
        const t = Number(r.letterTol.replace("%", ""));
        if (!(r.tcr === "K" || r.tcr === "L" || r.tcr === "M")) return false;
        if (!(t >= 1)) return false;
      }
      if (r.thinFilm === "M" && (r.size === "01" || r.size === "02" || r.size === "11" || r.size === "12")) {
        return false;
      }
      return true;
    }

    function selectedOrAll(key, options, localFilters) {
      const sel = localFilters[key];
      return sel === null ? options : options.filter((x) => x.key === sel);
    }

    function generateRows(localFilters) {
      const ohms = parseResistance(nodes.resInput.value);
      if (!isFinite(ohms) || ohms <= 0) return [];

      const rows = [];
      const ms = selectedOrAll("model", modelOptions, localFilters);
      const ts = selectedOrAll("tcr", tcrOptions, localFilters);
      const ss = selectedOrAll("size", sizeOptions, localFilters);
      const terms = selectedOrAll("termination", terminationOptions, localFilters);
      const ls = selectedOrAll("letter", letterOptions, localFilters);
      const frs = selectedOrAll("failure", failureRateOptions, localFilters);
      const pkgs = selectedOrAll("packaging", packagingOptions, localFilters);
      const tfs = selectedOrAll("thinFilm", thinFilmOptions, localFilters);

      for (const m of ms) {
        for (const t of ts) {
          for (const s of ss) {
            for (const term of terms) {
              for (const l of ls) {
                const vc = buildValueCode(ohms, l.key);
                if (!vc) continue;
                for (const fr of frs) {
                  for (const p of pkgs) {
                    for (const tf of tfs) {
                      const row = {
                        model: m.key,
                        tcr: t.key,
                        size: s.key,
                        termination: term.key,
                        letter: l.key,
                        letterTol: l.tol,
                        valueCode: vc.code,
                        valueNominal: vc.nominal,
                        valueErrorPct: vc.errorPct,
                        failure: fr.key,
                        packaging: p.key,
                        thinFilm: tf.key
                      };
                      if (!isValidRow(row)) continue;
                      row.pn = row.model + row.tcr + row.size + row.termination + row.valueCode + row.failure + row.packaging + row.thinFilm;
                      rows.push(row);
                    }
                  }
                }
              }
            }
          }
        }
      }
      return rows;
    }

    function matches(optionKey, optionVal) {
      const test = { ...filters, [optionKey]: optionVal };
      return generateRows(test).length;
    }

    function renderFilterGroup(key, host, options) {
      host.innerHTML = "";
      for (const opt of options) {
        const count = matches(key, opt.key);
        const pill = document.createElement("button");
        pill.type = "button";
        pill.className = "filter-pill";
        if (filters[key] === opt.key) pill.classList.add("active");
        if (count === 0) pill.classList.add("disabled");
        pill.disabled = count === 0 && filters[key] !== opt.key;
        pill.innerHTML = "<span>" + opt.label + "</span><span class=\"count\">" + count + "</span>";
        pill.addEventListener("click", () => {
          filters[key] = (filters[key] === opt.key) ? null : opt.key;
          renderAll();
        });
        host.appendChild(pill);
      }
    }

    function updatePnBar() {
      const ohms = parseResistance(nodes.resInput.value);
      const vc = (filters.letter && isFinite(ohms)) ? buildValueCode(ohms, filters.letter) : null;
      const pn =
        (filters.model || "M55342") +
        (filters.tcr || "_") +
        (filters.size || "__") +
        (filters.termination || "_") +
        (vc ? vc.code : "____") +
        (filters.failure || "_") +
        (filters.packaging || "__") +
        (filters.thinFilm === null ? "_" : (filters.thinFilm === "" ? "-" : filters.thinFilm));
      nodes.pnBarText.textContent = pn;
    }

    function renderResults() {
      const rows = generateRows(filters);
      nodes.resultCount.textContent = rows.length + " matches";
      nodes.statusText.textContent = rows.length ? "Filtered datasheet-code combinations" : "No matching combination";
      nodes.results.innerHTML = "";

      if (!rows.length) {
        const empty = document.createElement("div");
        empty.className = "result-card";
        empty.innerHTML = "<div class=\"pn\">No valid part numbers for current selections/resistance input.</div>";
        nodes.results.appendChild(empty);
        return;
      }

      const maxShown = 300;
      for (const row of rows.slice(0, maxShown)) {
        const card = document.createElement("article");
        card.className = "result-card";
        card.innerHTML =
          "<div class=\"pn\">" + row.pn + "</div>" +
          "<div class=\"meta\">" +
          "<span>Value Code: " + row.valueCode + "</span>" +
          "<span>Letter: " + row.letter + " (" + row.letterTol + ")</span>" +
          "<span>Rounded: " + formatOhms(row.valueNominal) + "</span>" +
          "<span>Error: " + row.valueErrorPct.toFixed(2) + "%</span>" +
          "</div>";
        nodes.results.appendChild(card);
      }
      if (rows.length > maxShown) {
        const more = document.createElement("div");
        more.className = "result-card";
        more.innerHTML = "<div class=\"pn\">Showing first " + maxShown + " of " + rows.length + " matches.</div>";
        nodes.results.appendChild(more);
      }
    }

    function formatOhms(v) {
      if (v >= 1e6) return (v / 1e6).toFixed(3).replace(/\.?0+$/, "") + " Mohm";
      if (v >= 1e3) return (v / 1e3).toFixed(3).replace(/\.?0+$/, "") + " kohm";
      return v.toFixed(3).replace(/\.?0+$/, "") + " ohm";
    }

    function renderAll() {
      renderFilterGroup("model", nodes.model, modelOptions);
      renderFilterGroup("tcr", nodes.tcr, tcrOptions);
      renderFilterGroup("size", nodes.size, sizeOptions);
      renderFilterGroup("termination", nodes.termination, terminationOptions);
      renderFilterGroup("letter", nodes.letter, letterOptions);
      renderFilterGroup("failure", nodes.failure, failureRateOptions);
      renderFilterGroup("packaging", nodes.packaging, packagingOptions);
      renderFilterGroup("thinFilm", nodes.thinFilm, thinFilmOptions);
      updatePnBar();
      renderResults();
    }

    nodes.clearBtn.addEventListener("click", () => {
      filters.model = null;
      filters.tcr = null;
      filters.size = null;
      filters.termination = null;
      filters.letter = null;
      filters.failure = null;
      filters.packaging = null;
      filters.thinFilm = null;
      renderAll();
    });

    nodes.resInput.addEventListener("input", renderAll);
    renderAll();
  </script>
</body>
</html>
